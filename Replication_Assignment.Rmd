---
title: "Replication_Assignment"
author: "Anais"
date: "3/14/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Introduction

 Short text description of the study and of the specific data and reanalyses you will be doing, to orient your reader. Outline (briefly!) the goal of the original paper, the data set used, and the analyses conducted, then describe which ones you will replicate.
 
 This document is divided is 3 parts
1. Summary statistic
 Replication of Table II. Summary statistics of soil observations
2.Linear model 
Replication of:
* Figure 5. pH Values as a function of time since glacial retreat for observations in the fluvial and stable zones, with potential debris flows in the stable zone separated from the rest of that zone. 
* Table III. Strength (r) and significance (p (r = 0)) of the correlation between the time since glacial retreat and soil properties, for the stable zone of the pro-glacial areas in all three valleys
3. Multiregression analysis
Replication of Table IV. Multiple linear regression model performance (r2 value) for soil properties for each valley
 
 
### Preliminaries 
-   Install and load in the following libraries:{tidyverse},{rstatix}

```{r, include=FALSE}

library(tidyverse)
library(rstatix) #for get_summary_stats()


```

-   Loading the data

* The soil data set comes from 111 locations visited; 46 in the Morteratsch (M) valley, 36 in the Tschierva (T) valley and 29 in the Forno (F) valley.
Previous analysis were made with an incomplete data set. When I figure it out during spring break, I asked Dr. Temme for another data set. On March 25th he sent me an excel document with many tabs. Then I ordered the data to create a clean CSV to work on R.
I have deleted my previous analysis and present in the document the new R code regarding the complete dataset.


```{r}
f <- "https://raw.githubusercontent.com/anaiszimmer/Data_Analysis_Replication_Assignment/main/Sites.csv"

#f<-"https://raw.githubusercontent.com/anaiszimmer/Data_Analysis_Replication_Assignment/main/Data_Kas.csv"
d <- read_csv(f, col_names = TRUE)
head(d)
View(d)


```
### 1. Summary statistic

* Paper's method: The T-test was used to test for differences in mean soil properties between the different zones in pro-glacial areas.

* Table II presents summary statistics for some numerical attributes of the soils for every pro-glacial valley for the stable and fluvial zones.

Note Dept of soil formation corresponds to the SSD (significant soil depth) values within the dataset.

```{r, include=true}
# 
# All_summary_stat<-d%>%
#   get_summary_stats(
#     pH_field,stoniness_soil, stoniness_surface,#variables of interest
#     type="common", # Common  statistics of interest
#     show=c("mean","sd"))%>% #summary stat to return
#   mutate_if(is.numeric, round, digits=1)
# All_summary_stat
# 
# 
# Valley_summary_stat<-d%>%
#   group_by(valley)%>%
#   get_summary_stats(
#     pH_field,stoniness_soil, stoniness_surface,#variables of interest
#     type="common", # Common  statistics of interest
#     show=c("mean","sd"))%>% #summary stat to return
#   mutate_if(is.numeric, round, digits=1)
# Valley_summary_stat


library(dplyr)
library(qwraps2)

options(qwraps2_markup = "markdown")

# summary.table <-
#   list("pH" =
#         list("Mean"= ~ mean(pH_field,digits=2),
#              "Standard deviation"= ~ sd(.data$pH_field)),
#       "Soil Stoniness" =
#         list("Mean"= ~ mean(stoniness_soil, digits=1),
#              "Standard deviation"= ~ sd(.data$stoniness_soil)),
#       "Surface Stoniness"=
#         list("Mean"= ~ mean(stoniness_surface),
#              "Standard deviation"= ~ sd(.data$stoniness_surface)))
# 

# d$geomorph_zone<-as.character(d$geomorph_zone)
# d<-d%>%group_by(geomorph_zone)

#selecting data with only "development" and "fluvial" zone from [geomorph_zone]

data<-d%>% filter(geomorph_zone!="none")%>%
  filter(geomorph_zone!="slope")%>%
  group_by(Site)
view(data)
  
options(digits = 2)  
table <-
  list("pH" =
        list("Mean"= ~ mean(.data$pH_field,na.rm=TRUE),
             "Standard deviation"= ~ sd(.data$pH_field,na.rm=TRUE)),
            # "p (s = f)"=t.test()),
       "Depth of soil formation (cm)" =
        list("Mean"= ~ mean(.data$SSD,na.rm=TRUE),
             "Standard deviation"= ~ sd(.data$SSD,na.rm=TRUE)),
       "Vegetation cover (%)" =
        list("Mean"= ~ mean(.data$veg_cover,na.rm=TRUE),
             "Standard deviation"= ~ sd(.data$veg_cover,na.rm=TRUE)),
      "Soil Stoniness (%)" =
        list("Mean"= ~ mean(.data$stoniness_soil),
             "Standard deviation"= ~ sd(.data$stoniness_soil)),
      "Surface Stoniness (%)"=
        list("Mean"= ~ mean(.data$stoniness_surf),
             "Standard deviation"= ~ sd(.data$stoniness_surf)))

by_site<-qwraps2::summary_table(dplyr::group_by(data,Site),table)
by_site

## DOES NOT WORK
#by_zone<-qwraps2::summary_table(dplyr::group_by(d,geomorph_zone),by_site)
#by_zone

options(digits = 2)  
whole<-qwraps2::summary_table(d,table)
whole<-round(whole,2)
str(whole)

#whole%>%format(round(2), nsmall = 2)

options(digits = 2)  
both <- cbind(whole, by_site)
both

print(both,
      rtitle = "Pro-glacial area",
      #rsubtilte=c("Fluvial", "Stable"),
      cnames = c("All", "Forno", "Tschierva", "Morteratsch"))

#*******************************************************************************

## Trying something else

#$pH_field<-as.numeric(d$pH_field)

Summary<-data%>%
  select(Site, geomorph_zone,pH_field, stoniness_soil, stoniness_surf, veg_cover,SSD)%>%
  group_by(Site, geomorph_zone)%>%
  filter(geomorph_zone=="fluvial"| geomorph_zone== "development")%>%
  summarise(across(c("pH_field", "stoniness_soil", "stoniness_surf", "veg_cover","SSD"),list(Mean=mean, SD=sd),na.rm=TRUE)) ### !!!!!!!! Need to add a function COUNT that have a na.rm argument
Summary


temp <- data %>%  group_by(Site, geomorph_zone) %>% summarize(n=n())

temp2 <- left_join(Summary,temp,by=(c("Site","geomorph_zone")))

table<-Summary%>%
  list("pH"=
         list("Mean"=Summary$pH_field_Mean),
       "Standard deviation"=Summary$pH_field_SD)
       
print(table)

Summary<-as.data.frame(Summary)
```

```{r, include=true}
##T-test


#formul construction inside ttest
#pH_Forno






data_forno<-data%>%filter(Site=="Forno")%>%
  select(geomorph_zone,pH_field,point)

x=t.test(pH_field~geomorph_zone,data=data_forno)$p.value
str(x)


data_forno$pH_fluvial<-ifelse(data_forno$geomorph_zone=="fluvial",data_forno$pH_field, NA)
data_forno$pH_development<-ifelse(data_forno$geomorph_zone=="development",data_forno$pH_field, NA)
t.test(data_forno$pH_fluvial,data_forno$pH_development)

#pH_Tschierva
data_T<-data%>%filter(Site=="Tschierva")%>%
  select(geomorph_zone,pH_field,point)%>%
  group_by(geomorph_zone)%>%
  mutate

data_T$pH_fluvial<-ifelse(data_T$geomorph_zone=="fluvial",data_T$pH_field, NA)
data_T$pH_development<-ifelse(data_T$geomorph_zone=="development",data_T$pH_field, NA)
t.test(data_T$pH_fluvial,data_T$pH_development)

#pH_Morteratsch
data_M<-data%>%filter(Site=="Morteratsch")%>%
  select(geomorph_zone,pH_field)%>%
  group_by(geomorph_zone)%>%
  mutate

data_M$pH_fluvial<-ifelse(data_M$geomorph_zone=="fluvial",data_M$pH_field, NA)
data_M$pH_development<-ifelse(data_M$geomorph_zone=="development",data_M$pH_field, NA)
t.test(data_M$pH_fluvial,data_M$pH_development)

```

Figure 5. pH Values as a function of time since glacial retreat for observations in the fluvial and stable zones, with potential debris flows in the stable zone separated from the rest of that zone.
From Figure 5, it is clear that observations on the recognized debris flows have pH values that are
relatively high, like observations on the fluvial locations, and unlike the other observations in the stable zone. This suggests that debris flows, which originate from hillslopes outside the pro-glacial area and that have been de-glaciated for millennia, nevertheless provide relatively fresh and unweathered material to the pro-glacial area.

```{r, include=TRUE}

library(tidyverse)

#creating a new data set to remove "slope" and "none" values of the [geomorh_zone variable]
d_stability_Forno<-d%>%filter(Site=="Forno")%>% ###COMMENTS : It took me a very long while to understand the graph was only including the Forno data set!
  filter(geomorph_zone!="none")%>%
  filter(geomorph_zone!="slope")



#test after talking with Tony
d_stability_Forno<-d_stability_Forno%>%
  mutate(stability=case_when(
    geomorph_zone=="development" & potential_dist=="debris flow"~"stable-debris",
    geomorph_zone=="development"~"stable",
    geomorph_zone=="fluvial"~"fluvial"))

view(d_stability_Forno)

#-****************************************************


# #creating new variable for "stability"
#   #stable-debris if potential_disturbance = debris flow
#   #stable if geomorpho_zome= development and potential_disturbance=NA
#   #fluvial if geomorph_zone=fluvial
# 
# d_stability_Forno$stability<-ifelse(d_stability_Forno$geomorph_zone=="fluvial",1, ifelse(d$potential_dist=="debris flow", 2,3))
# #could not create directly a character value - so I use number as coding
# view(d_stability_Forno)
# 
# d_stability_Forno %>% mutate(stability=str_replace(stability,'1','fluvial'))->d_stability_Forno
# d_stability_Forno %>% mutate(stability=str_replace(stability,'2','stable debris'))->d_stability_Forno
# d_stability_Forno %>% mutate(stability=str_replace(stability,'3','stable'))->d_stability_Forno
# view(d_stability_Forno)

d_stability_Forno$stability<-factor(d_stability_Forno$stability,levels=c("stable-debris", "stable","fluvial"))

pH_time<-ggplot(d_stability_Forno, aes(y=pH_field, x=realTSR, color=stability)) +
  geom_point(aes(color=stability), size=3) +
  scale_color_manual(values=c('hotpink3','darkgreen','deepskyblue3'))+
  theme_bw()+ 
  coord_cartesian(xlim=c(0,120),ylim=c(4,8)) +
  scale_x_continuous(breaks = c(0, 20, 40, 60, 80, 100,120))+
  labs(x="time since glacial retreat (y)", y="pH") +
  theme_bw()
pH_time



F28?? 
```
#On this first version of the graph we still observe two points that are different: one that appear as stable and should appear as stable-debris.

Now looking at teh same graph but using different shapes to draw the pH values, we notice that F27 and F29 where superposed. 
The blue luvial F27 was hidden by the green stable 29.


```{r}
pH_time<-ggplot(d_stability_Forno, aes(y=pH_field, x=realTSR, color=stability)) +
  geom_point(aes(shape=stability,color=stability), size=3) +
  scale_color_manual(values=c('hotpink3','darkgreen','deepskyblue3'))+
  scale_shape_manual(values=c(22,21,24))+
  theme_bw()+ 
  coord_cartesian(xlim=c(0,120),ylim=c(4,8)) +
  scale_x_continuous(breaks = c(0, 20, 40, 60, 80, 100,120))+
  labs(x="time since glacial retreat (y)", y="pH") +
  ggrepel::geom_text_repel(data=d_stability_Forno,mapping= aes(label=d_stability_Forno$point),size=3,box.padding=unit(0.5,"lines"))+
  theme_bw()
pH_time
```

Similar conclusion are observed using geom_jitter(), and playing with the transparency alpha:

```{r}

pH_time<-ggplot(d_stability_Forno, aes(y=pH_field, x=realTSR, color=stability)) +
  geom_jitter(aes(color=stability), size=3, alpha=0.5) +
  scale_color_manual(values=c('hotpink3','darkgreen','deepskyblue3'))+
  theme_bw()+ 
  coord_cartesian(xlim=c(0,120),ylim=c(4,8)) +
  scale_x_continuous(breaks = c(0, 20, 40, 60, 80, 100,120))+
  labs(x="time since glacial retreat (y)", y="pH") +
  ggrepel::geom_text_repel(data=d_stability_Forno,mapping= aes(label=d_stability_Forno$point),size=3,box.padding=unit(0.5,"lines"))+
  theme_bw()
pH_time

```

However, there is still a difference according F28 that appear as stable-debris in Figure 5, and stable in our graph.
And one other fluvial point between F24 and F22 is missing.
Looking at the Tab "Table 5-1" of the original data received is seems a slightly different data set is present there. 
It looks like the F28 point (with the following value: stoniness surface 50; stoniness soil 30, veg cover 50, pH field 7, SSD 0.7) was maked as debris flow (Potential disturbance variable) in this extra dataset, but not in the Export data set used here. since the extra dataset is not complete and does not include the name of the points this cannot be verified.

Below the same code is run with this alternative data set called "Fig_5_alternative_data".

```{r}



```


### 2. Linear model


Linear models for the various numerical soil properties were estimated with time and topographical properties as explanatory variables in order to assess the joint effect of time and topography.
Table IV summarizes model performance for each of the soil properties in each of the valleys.

```{r, include=TRUE}
















```




